<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AnimeStream - Catálogo Final</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css"> <script src="funciones.js" defer></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        accent: '#f3c669', // Color de acento
                    },
                }
            }
        }
    </script>
    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #4b5563; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-track { background-color: #374151; } /* slate-700 */
        
        .modal-open {
            overflow: hidden; 
        }
    </style>
</head>
<body class="bg-black text-white">
    <header id="mainHeader" class="fixed top-0 w-full z-50">
    <div class="container mx-auto px-4 sm:px-6 lg:px-12">
        <div class="flex items-center justify-between h-16 lg:h-20">
            <div class="flex items-center space-x-4 lg:space-x-6">
                <a href="index.html" class="flex items-center space-x-2 flex-shrink-0">
                    <div class="w-9 h-9 lg:w-10 lg:h-10 bg-accent rounded-lg flex items-center justify-center shadow-md">
                        <i class="fas fa-play text-black text-base lg:text-lg"></i>
                    </div>
                    <span class="text-lg lg:text-2xl font-bold text-white">AnimeStream</span>
                </a>
                <nav class="hidden lg:flex items-center space-x-4 xl:space-x-5">
                    <a href="index.html" class="text-gray-300 hover:text-accent transition-colors text-base font-medium">Inicio</a>
                    <a href="catalogo.html" class="text-accent font-semibold transition-colors text-base">Catálogo</a>
                    <a href="tendencia.html" class="text-gray-300 hover:text-accent transition-colors text-base font-medium">Tendencia</a>
                    <a href="top.html" class="text-gray-300 hover:text-accent transition-colors text-base font-medium">Top</a>
                </nav>
            </div>

            <div class="flex items-center space-x-2 lg:space-x-3 flex-shrink-0">
                <div class="hidden lg:block relative">
                    <button id="desktopSearchBtn" class="text-gray-300 hover:text-accent transition-colors p-2 group" title="Buscar">
                        <i class="fas fa-search text-lg"></i>
                    </button>
                    <div id="desktopSearchInputContainer" class="absolute top-0 right-11 w-72 hidden">
                        <input type="text" placeholder="Buscar anime..." class="bg-gray-800 text-white w-full rounded-full py-2.5 px-5 focus:outline-none focus:ring-2 ring-accent transition-all text-sm shadow-lg">
                    </div>
                </div>
                <button title="Perfil" class="w-9 h-9 lg:w-10 lg:h-10 bg-gray-700/70 hover:bg-gray-600/90 text-gray-300 rounded-full transition-colors flex items-center justify-center">
                    <i class="fas fa-user text-base lg:text-lg"></i>
                </button>
                <button id="mobileSearchBtn" title="Buscar" class="lg:hidden w-9 h-9 bg-gray-700/70 hover:bg-gray-600/90 text-gray-300 rounded-full transition-colors flex items-center justify-center">
                    <i class="fas fa-search text-base"></i>
                </button>
                <button class="lg:hidden text-gray-300 hover:text-accent transition-colors p-1" id="mobileMenuBtn" title="Menú">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>
    </div>
</header>

    <div id="mobileMenu" class="fixed inset-0 bg-gray-900/95 backdrop-blur-md z-[60] mobile-panel"><div class="flex flex-col items-center justify-center h-full space-y-8"><a href="index.html" class="text-2xl hover:text-accent transition-colors">Inicio</a><a href="catalogo.html" class="text-2xl text-accent font-semibold">Catálogo</a><a href="tendencia.html" class="text-2xl hover:text-accent transition-colors">Tendencia</a><a href="top.html" class="text-2xl hover:text-accent transition-colors">Top</a><button id="closeMobileMenu" class="mt-8 text-gray-400"><i class="fas fa-times text-3xl"></i></button></div></div>
    <div id="mobileSearch" class="fixed top-16 inset-x-0 bg-gray-900/95 backdrop-blur-md z-[55] p-4 mobile-panel"><div class="relative"><input type="text" placeholder="Buscar anime..." class="bg-gray-800 text-white w-full rounded-full py-3 pl-12 pr-12 focus:outline-none focus:ring-2 focus:ring-accent transition-all"><i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i><button id="closeMobileSearch" class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white"><i class="fas fa-times text-lg"></i></button></div><div class="mt-4 text-sm text-gray-400"><p class="mb-2">Búsquedas populares:</p><div class="flex flex-wrap gap-2"><span class="bg-gray-800 px-3 py-1 rounded-full">One Piece</span><span class="bg-gray-800 px-3 py-1 rounded-full">Demon Slayer</span><span class="bg-gray-800 px-3 py-1 rounded-full">Jujutsu Kaisen</span></div></div></div>

    <main class="container mx-auto pt-24 lg:pt-28 pb-12 px-4 sm:px-6 lg:px-8">

        <section class="mb-10 p-5 sm:p-6 bg-slate-800 rounded-lg shadow-lg">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end">
                <div class="lg:col-span-2">
                    <label for="search-series" class="block text-sm font-medium text-gray-300 mb-1.5">Buscar Serie</label>
                    <div class="relative">
                        <input type="text" id="search-series" placeholder="Nombre de la serie..." 
                            class="w-full bg-slate-700 border border-slate-600 text-gray-200 rounded-md pl-10 pr-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition-all text-sm shadow-sm">
                        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    </div>
                </div>
                <div>
                    <label for="sort-by" class="block text-sm font-medium text-gray-300 mb-1.5">Ordenar Por</label>
                    <select id="sort-by" class="w-full bg-slate-700 border border-slate-600 text-gray-300 rounded-md px-3 py-2.5 focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition-all text-sm shadow-sm">
                        <option value="recent">Más recientes</option>
                        <option value="popular">Más populares</option>
                        <option value="rating">Mejor valorados</option>
                        <option value="alphabetical">Alfabético (A-Z)</option>
                    </select>
                </div>
                <div class="hidden lg:block">
                     <button class="w-full bg-accent hover:bg-yellow-500 text-black font-semibold py-2.5 rounded-md transition-colors text-sm shadow-sm">
                        Buscar
                    </button>
                </div>
            </div>
            <div class="mt-5 pt-4 border-t border-slate-700">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label for="openGenreModalBtn" class="block text-sm font-medium text-gray-300 mb-1.5">Géneros</label>
                        <button id="openGenreModalBtn" class="w-full bg-slate-700 border border-slate-600 text-gray-300 rounded-md px-3 py-2.5 text-sm text-left hover:bg-slate-600 transition-colors flex justify-between items-center shadow-sm">
                            <span id="genreSelectionText">Seleccionar...</span>
                            <i class="fas fa-chevron-down text-xs text-gray-400"></i>
                        </button>
                    </div>
                     <div>
                        <label for="status-filter" class="block text-sm font-medium text-gray-300 mb-1.5">Estado</label>
                        <select id="status-filter" class="w-full bg-slate-700 border border-slate-600 text-gray-300 rounded-md px-3 py-2.5 focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition-all text-sm shadow-sm">
                            <option value="">Todos</option>
                            <option value="emision">En emisión</option>
                            <option value="finalizado">Finalizado</option>
                            <option value="proximamente">Próximamente</option>
                        </select>
                    </div>
                    <div>
                        <label for="year-filter" class="block text-sm font-medium text-gray-300 mb-1.5">Año</label>
                        <select id="year-filter" class="w-full bg-slate-700 border border-slate-600 text-gray-300 rounded-md px-3 py-2.5 focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition-all text-sm shadow-sm">
                            <option value="">Todos</option>
                            <option value="2025">2025</option>
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                            <option value="2022">2022</option>
                        </select>
                    </div>
                </div>
                <div class="mt-6 text-center lg:hidden">
                     <button class="w-full sm:w-auto bg-accent hover:bg-yellow-500 text-black font-semibold py-2.5 px-6 rounded-md transition-colors text-sm shadow-sm">
                        Aplicar Filtros
                    </button>
                </div>
            </div>
        </section>

        <div id="genreModal" class="fixed inset-0 bg-black/70 backdrop-blur-sm z-[70] hidden flex items-center justify-center p-4 transition-opacity duration-300 ease-in-out opacity-0">
            <div class="bg-slate-800 p-5 sm:p-6 rounded-lg shadow-xl w-full max-w-xl max-h-[85vh] flex flex-col">
                <div class="flex items-center justify-between mb-4">
                    <h4 class="text-lg font-semibold text-white">Seleccionar Géneros</h4>
                    <button id="closeGenreModalBtn" aria-label="Cerrar modal de géneros" class="text-gray-400 hover:text-white text-2xl leading-none">&times;</button>
                </div>
                <div class="mb-4">
                    <input type="text" id="searchGenreInput" placeholder="Buscar género..." class="w-full bg-slate-700 border border-slate-600 text-gray-200 rounded-md px-3.5 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-accent shadow-sm">
                </div>
                <div id="genreListContainer" class="overflow-y-auto grid grid-cols-2 sm:grid-cols-3 gap-x-3 gap-y-1.5 pr-1.5 custom-scrollbar flex-grow mb-4">
                    {}
                </div>
                <div class="mt-auto pt-4 flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-3 border-t border-slate-700">
                    <button id="clearGenreSelectionBtn" class="px-4 py-2 text-sm bg-slate-600 hover:bg-slate-500 text-gray-200 rounded-md transition-colors w-full sm:w-auto">Limpiar (<span id="selectedGenresCountClear">0</span>)</button>
                    <button id="applyGenreSelectionBtn" class="px-4 py-2 text-sm bg-accent hover:bg-yellow-500 text-black font-semibold rounded-md transition-colors w-full sm:w-auto">Aplicar (<span id="selectedGenresCountApply">0</span>)</button>
                </div>
            </div>
        </div>

        <section>
            <div class="flex flex-col sm:flex-row items-center justify-between mb-6">
                <p class="text-gray-400 text-sm mb-3 sm:mb-0">Mostrando <span class="text-white font-medium">120</span> series</p>
                <div class="flex items-center gap-1.5">
                    <button title="Vista de cuadrícula" class="w-9 h-9 bg-slate-700 text-accent rounded-md hover:bg-slate-600 transition-all flex items-center justify-center shadow-sm">
                        <i class="fas fa-th-large text-sm"></i>
                    </button>
                    <button title="Vista de lista" class="w-9 h-9 bg-slate-800 text-gray-400 rounded-md hover:bg-slate-600 hover:text-accent transition-all flex items-center justify-center shadow-sm">
                        <i class="fas fa-list text-sm"></i>
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-5 lg:gap-6">
                
                <div class="group bg-slate-800 rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 flex flex-col cursor-pointer border border-slate-700/50 hover:border-accent/40">
                    <div class="bg-slate-700/50 p-1"> 
                        <div class="aspect-[3/4] overflow-hidden rounded-md">
                            <img src="https://media.themoviedb.org/t/p/w300_and_h450_bestv2/gFs2oxAjyzMu7Bx9mUJKeW3K4ym.jpg" 
                                 alt="Frieren: Más allá del final del viaje" 
                                 class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105">
                        </div>
                    </div>
                    <div class="p-4 flex flex-col flex-grow">
                        <h3 class="font-bold text-base md:text-lg text-gray-100 mb-2 line-clamp-2 group-hover:text-accent transition-colors h-[3.2em] md:h-[3.6em]">Frieren: Más allá del final del viaje</h3>
                        <div class="grid grid-cols-2 gap-x-3 gap-y-1.5 text-xs text-gray-400 mb-3">
                            <div class="flex items-center" title="Año de emisión">
                                <i class="fas fa-calendar-alt fa-fw mr-1.5 text-gray-500"></i>
                                <span>2023</span>
                            </div>
                            <div class="flex items-center" title="Episodios">
                                <i class="fas fa-tv fa-fw mr-1.5 text-gray-500"></i>
                                <span>28 ep.</span>
                            </div>
                            <div class="flex items-center" title="Estado">
                                <i class="fas fa-satellite-dish fa-fw mr-1.5 text-green-400"></i>
                                <span class="text-green-300">En Emisión</span>
                            </div>
                            <div class="flex items-center" title="Rating">
                                <i class="fas fa-star fa-fw mr-1.5 text-yellow-400"></i>
                                <span class="text-yellow-300">9.5</span>
                            </div>
                        </div>
                        <p class="text-xs sm:text-sm text-gray-400/80 line-clamp-3 mb-4 flex-grow min-h-[4.5em]">
                            La maga elfa Frieren se embarca en un nuevo viaje para conocer de verdad a las personas tras la muerte de un antiguo compañero.
                        </p>
                        <div class="mt-auto">
                            <button class="w-full bg-accent hover:bg-yellow-500 focus:bg-yellow-500 text-black font-semibold py-2.5 rounded-lg transition-colors text-sm shadow-md focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:ring-opacity-75">
                                <i class="fas fa-play mr-1.5 opacity-90"></i>Ver Ahora
                            </button>
                        </div>
                    </div>
                </div>

                <div class="group bg-slate-800 rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 flex flex-col cursor-pointer border border-slate-700/50 hover:border-accent/40">
                    <div class="bg-slate-700/50 p-1">
                        <div class="aspect-[3/4] overflow-hidden rounded-md">
                            <img src="https://media.themoviedb.org/t/p/w300_and_h450_bestv2/eH8lVTd3LgE0CH4h4d522A3O4su.jpg" 
                                 alt="One Piece" 
                                 class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105">
                        </div>
                    </div>
                    <div class="p-4 flex flex-col flex-grow">
                        <h3 class="font-bold text-base md:text-lg text-gray-100 mb-2 line-clamp-2 group-hover:text-accent transition-colors h-[3.2em] md:h-[3.6em]">One Piece</h3>
                        <div class="grid grid-cols-2 gap-x-3 gap-y-1.5 text-xs text-gray-400 mb-3">
                            <div class="flex items-center" title="Año de emisión">
                                <i class="fas fa-calendar-alt fa-fw mr-1.5 text-gray-500"></i>
                                <span>1999</span>
                            </div>
                            <div class="flex items-center" title="Episodios">
                                <i class="fas fa-tv fa-fw mr-1.5 text-gray-500"></i>
                                <span>1089+ ep.</span>
                            </div>
                            <div class="flex items-center" title="Estado">
                                <i class="fas fa-satellite-dish fa-fw mr-1.5 text-green-400"></i>
                                <span class="text-green-300">En Emisión</span>
                            </div>
                            <div class="flex items-center" title="Rating">
                                <i class="fas fa-star fa-fw mr-1.5 text-yellow-400"></i>
                                <span class="text-yellow-300">9.0</span>
                            </div>
                        </div>
                        <p class="text-xs sm:text-sm text-gray-400/80 line-clamp-3 mb-4 flex-grow min-h-[4.5em]">
                            Monkey D. Luffy y su tripulación de piratas navegan por Grand Line en busca del tesoro más grande del mundo, el "One Piece".
                        </p>
                        <div class="mt-auto">
                            <button class="w-full bg-accent hover:bg-yellow-500 focus:bg-yellow-500 text-black font-semibold py-2.5 rounded-lg transition-colors text-sm shadow-md focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:ring-opacity-75">
                                <i class="fas fa-play mr-1.5 opacity-90"></i>Ver Ahora
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="group bg-slate-800 rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 flex flex-col cursor-pointer border border-slate-700/50 hover:border-accent/40">
                    <div class="bg-slate-700/50 p-1">
                        <div class="aspect-[3/4] overflow-hidden rounded-md">
                            <img src="https://media.themoviedb.org/t/p/w300_and_h450_bestv2/lwLFZFB3S2PeOLtWksaWerF6B4D.jpg" 
                                 alt="Jujutsu Kaisen" 
                                 class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105">
                        </div>
                    </div>
                    <div class="p-4 flex flex-col flex-grow">
                        <h3 class="font-bold text-base md:text-lg text-gray-100 mb-2 line-clamp-2 group-hover:text-accent transition-colors h-[3.2em] md:h-[3.6em]">Jujutsu Kaisen</h3>
                        <div class="grid grid-cols-2 gap-x-3 gap-y-1.5 text-xs text-gray-400 mb-3">
                            <div class="flex items-center" title="Año de emisión">
                                <i class="fas fa-calendar-alt fa-fw mr-1.5 text-gray-500"></i>
                                <span>2020</span>
                            </div>
                            <div class="flex items-center" title="Episodios">
                                <i class="fas fa-tv fa-fw mr-1.5 text-gray-500"></i>
                                <span>24 ep.</span>
                            </div>
                            <div class="flex items-center" title="Estado">
                                <i class="fas fa-satellite-dish fa-fw mr-1.5 text-blue-400"></i>
                                <span class="text-blue-300">Finalizado</span>
                            </div>
                            <div class="flex items-center" title="Rating">
                                <i class="fas fa-star fa-fw mr-1.5 text-yellow-400"></i>
                                <span class="text-yellow-300">8.8</span>
                            </div>
                        </div>
                        <p class="text-xs sm:text-sm text-gray-400/80 line-clamp-3 mb-4 flex-grow min-h-[4.5em]">
                           Un estudiante de secundaria se une a una organización secreta de hechiceros para luchar contra poderosas maldiciones.
                        </p>
                        <div class="mt-auto">
                            <button class="w-full bg-accent hover:bg-yellow-500 focus:bg-yellow-500 text-black font-semibold py-2.5 rounded-lg transition-colors text-sm shadow-md focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:ring-opacity-75">
                                <i class="fas fa-play mr-1.5 opacity-90"></i>Ver Ahora
                            </button>
                        </div>
                    </div>
                </div>

                <div class="group bg-slate-800 rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 flex flex-col cursor-pointer border border-slate-700/50 hover:border-accent/40">
                    <div class="bg-slate-700/50 p-1">
                        <div class="aspect-[3/4] overflow-hidden rounded-md">
                            <img src="https://media.themoviedb.org/t/p/w300_and_h450_bestv2/ra8CKkCHjSok8L9meEP4WuOukNK.jpg" 
                                 alt="Demon Slayer: Kimetsu no Yaiba" 
                                 class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105">
                        </div>
                    </div>
                    <div class="p-4 flex flex-col flex-grow">
                        <h3 class="font-bold text-base md:text-lg text-gray-100 mb-2 line-clamp-2 group-hover:text-accent transition-colors h-[3.2em] md:h-[3.6em]">Demon Slayer: Kimetsu no Yaiba</h3>
                        <div class="grid grid-cols-2 gap-x-3 gap-y-1.5 text-xs text-gray-400 mb-3">
                            <div class="flex items-center" title="Año de emisión">
                                <i class="fas fa-calendar-alt fa-fw mr-1.5 text-gray-500"></i>
                                <span>2019</span>
                            </div>
                            <div class="flex items-center" title="Episodios">
                                <i class="fas fa-tv fa-fw mr-1.5 text-gray-500"></i>
                                <span>26 ep.</span>
                            </div>
                            <div class="flex items-center" title="Estado">
                                 <i class="fas fa-satellite-dish fa-fw mr-1.5 text-blue-400"></i>
                                <span class="text-blue-300">Finalizado</span>
                            </div>
                            <div class="flex items-center" title="Rating">
                                <i class="fas fa-star fa-fw mr-1.5 text-yellow-400"></i>
                                <span class="text-yellow-300">8.7</span>
                            </div>
                        </div>
                         <p class="text-xs sm:text-sm text-gray-400/80 line-clamp-3 mb-4 flex-grow min-h-[4.5em]">
                           Tanjiro Kamado busca una cura para su hermana convertida en demonio, uniéndose a los cazadores de demonios.
                        </p>
                        <div class="mt-auto">
                             <button class="w-full bg-accent hover:bg-yellow-500 focus:bg-yellow-500 text-black font-semibold py-2.5 rounded-lg transition-colors text-sm shadow-md focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:ring-opacity-75">
                                <i class="fas fa-play mr-1.5 opacity-90"></i>Ver Ahora
                            </button>
                        </div>
                    </div>
                </div>
                </div>
            
            <div class="mt-12 flex justify-center items-center space-x-1.5 sm:space-x-2"> <button class="px-3 py-1.5 sm:px-4 sm:py-2 bg-slate-700 text-gray-400 rounded-md hover:bg-slate-600 transition-colors text-xs sm:text-sm disabled:opacity-50" disabled>Anterior</button> <button class="px-3 py-1.5 sm:px-4 sm:py-2 bg-slate-700 text-gray-300 rounded-md hover:bg-slate-600 transition-colors text-xs sm:text-sm">1</button> <button class="px-3 py-1.5 sm:px-4 sm:py-2 bg-accent text-black font-semibold rounded-md text-xs sm:text-sm">2</button> <button class="px-3 py-1.5 sm:px-4 sm:py-2 bg-slate-700 text-gray-300 rounded-md hover:bg-slate-600 transition-colors text-xs sm:text-sm">3</button> <span class="text-gray-500 hidden sm:inline">...</span> <button class="px-3 py-1.5 sm:px-4 sm:py-2 bg-slate-700 text-gray-300 rounded-md hover:bg-slate-600 transition-colors text-xs sm:text-sm">10</button> <button class="px-3 py-1.5 sm:px-4 sm:py-2 bg-slate-700 text-gray-300 rounded-md hover:bg-slate-600 transition-colors text-xs sm:text-sm">Siguiente</button></div>
        </section>
    </main>

    <footer class="bg-slate-900 border-t border-slate-800 py-8 text-center mt-16"> <div class="container mx-auto px-4 sm:px-6 lg:px-12"><div class="flex flex-col items-center justify-center mb-4"><a href="index.html" class="flex items-center space-x-2 mb-2"><div class="w-8 h-8 bg-accent rounded-md flex items-center justify-center shadow-md"><i class="fas fa-play text-black text-sm"></i></div><span class="text-lg font-bold text-white">AnimeStream</span></a><p class="text-gray-400 text-sm">&copy; 2024-2025 AnimeStream. Todos los derechos reservados.</p></div><div class="text-gray-500 text-xs"><p>Este sitio es un proyecto de demostración. Contenido placeholder.</p></div></div></footer>

    <script>
        // Script para manejar el modal de géneros y la selección (SIN CAMBIOS DESDE LA VERSIÓN ANTERIOR)
        document.addEventListener('DOMContentLoaded', () => {
            const openGenreModalBtn = document.getElementById('openGenreModalBtn');
            const closeGenreModalBtn = document.getElementById('closeGenreModalBtn');
            const genreModal = document.getElementById('genreModal');
            const genreListContainer = document.getElementById('genreListContainer');
            const searchGenreInput = document.getElementById('searchGenreInput');
            const genreSelectionText = document.getElementById('genreSelectionText');
            const selectedGenresCountApply = document.getElementById('selectedGenresCountApply');
            const selectedGenresCountClear = document.getElementById('selectedGenresCountClear');
            const applyGenreSelectionBtn = document.getElementById('applyGenreSelectionBtn');
            const clearGenreSelectionBtn = document.getElementById('clearGenreSelectionBtn');

            const allGenres = ["Acción", "Aventura", "Comedia", "Drama", "Fantasía", "Sci-Fi", "Romance", "Misterio", "Slice of Life", "Sobrenatural", "Deportes", "Horror", "Psicológico", "Mecha", "Histórico", "Shounen", "Seinen", "Shoujo", "Josei", "Isekai", "Música", "Escolar", "Cyberpunk", "Policial", "Demonios", "Magia", "Vampiros", "Samurai", "Superpoderes", "Militar", "Espacial", "Artes Marciales", "Parodia", "Carreras", "Juegos", "Infantil", "Gore", "Suspense", "Thriller", "Ecchi", "Harem", "Yaoi", "Yuri"];

            function populateGenreList(filter = "") {
                if (!genreListContainer) return;
                genreListContainer.innerHTML = ''; 
                const filteredGenres = allGenres.filter(genre => genre.toLowerCase().includes(filter.toLowerCase()));
                
                filteredGenres.forEach(genre => {
                    const label = document.createElement('label');
                    label.className = "flex items-center space-x-2.5 text-sm text-gray-300 hover:bg-slate-700/70 p-1.5 rounded-md cursor-pointer transition-colors";
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.value = genre.toLowerCase().replace(/\s+/g, '-');
                    checkbox.className = "genre-checkbox h-4 w-4 rounded border-gray-500 bg-slate-600 text-accent focus:ring-2 focus:ring-accent/50 focus:ring-offset-2 focus:ring-offset-slate-800 appearance-none checked:bg-accent checked:border-transparent relative custom-checkbox-style";
                    label.appendChild(checkbox);
                    const span = document.createElement('span');
                    span.textContent = genre;
                    label.appendChild(span);
                    genreListContainer.appendChild(label);
                });
                updateSelectedCount(); 
            }
            
            if (genreListContainer) populateGenreList();

            function updateSelectedCount() {
                if (!genreListContainer) return;
                const selectedCheckboxes = genreListContainer.querySelectorAll('.genre-checkbox:checked');
                const count = selectedCheckboxes.length;
                if (selectedGenresCountApply) selectedGenresCountApply.textContent = count;
                if (selectedGenresCountClear) selectedGenresCountClear.textContent = count;
                if (genreSelectionText) {
                    if (count === 0) {
                        genreSelectionText.textContent = "Seleccionar...";
                    } else if (count === 1) {
                        const firstSelectedSpan = genreListContainer.querySelector('.genre-checkbox:checked + span');
                        genreSelectionText.textContent = firstSelectedSpan ? firstSelectedSpan.textContent : `${count} seleccionado`;
                    } else {
                        genreSelectionText.textContent = `${count} géneros seleccionados`;
                    }
                }
            }

            if (genreListContainer) {
                genreListContainer.addEventListener('change', updateSelectedCount);
            }
            
            if (openGenreModalBtn) {
                openGenreModalBtn.addEventListener('click', () => {
                    if (genreModal) {
                        genreModal.classList.remove('hidden');
                        setTimeout(() => genreModal.classList.remove('opacity-0'), 10); // For transition
                        document.body.classList.add('modal-open');
                    }
                });
            }

            if (closeGenreModalBtn) {
                closeGenreModalBtn.addEventListener('click', () => {
                    if (genreModal) {
                        genreModal.classList.add('opacity-0');
                        setTimeout(() => genreModal.classList.add('hidden'), 300);
                        document.body.classList.remove('modal-open');
                    }
                });
            }
            
            if (genreModal) {
                genreModal.addEventListener('click', (event) => {
                    if (event.target === genreModal) {
                       if (closeGenreModalBtn) closeGenreModalBtn.click();
                    }
                });
            }

            if (searchGenreInput) {
                searchGenreInput.addEventListener('input', (e) => {
                    populateGenreList(e.target.value);
                });
            }

            if (applyGenreSelectionBtn) {
                applyGenreSelectionBtn.addEventListener('click', () => {
                    if (genreListContainer) {
                        console.log("Géneros aplicados:", Array.from(genreListContainer.querySelectorAll('.genre-checkbox:checked')).map(cb => cb.value));
                    }
                    if (closeGenreModalBtn) closeGenreModalBtn.click();
                });
            }
            
            if (clearGenreSelectionBtn) {
                clearGenreSelectionBtn.addEventListener('click', () => {
                    if (genreListContainer) {
                        genreListContainer.querySelectorAll('.genre-checkbox:checked').forEach(checkbox => checkbox.checked = false);
                    }
                    updateSelectedCount();
                });
            }

            const style = document.createElement('style');
            style.textContent = `
                .custom-checkbox-style:checked::after {
                    content: '\\2713'; 
                    display: block;
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    font-size: 0.75rem; 
                    color: black; 
                    line-height: 1;
                }
            `;
            document.head.appendChild(style);
        });
    </script>

</body>
</html>